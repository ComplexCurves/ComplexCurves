<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Complex Curves</title>
<link rel="shortcut icon" href="examples/favicon.ico" />
<script type="text/javascript" src="build/SingularityExplorer.js"></script>
<script type="text/javascript">
var examples, results, oldvalue;

function appendExample(curves, example, interactive = false) {
    var curve = document.createElement("div");
    curve.id = example.id;
    curve.setAttribute("class", "curve");
    curve.style = "float: left; margin: 0.5em 0.5em 0.5em 0; padding: 1em; box-shadow: 0 1px 2px 0 rgba(34, 36, 38, 0.15); border-radius: .28571429rem; border: 1px solid rgba(34, 36, 38, .15)";
    if (interactive) {
        if (example.cached) {
            var iframe = document.createElement("iframe");
            iframe.src = "examples/" + example.id + ".cached.html";
            iframe.width = 450;
            iframe.height = 450;
            iframe.scrolling = "no";
            iframe.setAttribute("frameborder", "0");
            curve.appendChild(iframe);
        } else {
            var canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 800;
            canvas.style.width = "450px";
            canvas.style.height = "450px";
            curve.appendChild(canvas);
            canvas.singularityExplorer =
                SingularityExplorer.fromEquation(canvas, example.equation,
                    example.depth || 12);
        }
    } else {
        var imgContainer = document.createElement("div");
        imgContainer.style = "display: table-cell; width: 450px; height: 450px; text-align: center; vertical-align: middle";
        var img = document.createElement("img");
        img.src = "examples/" + example.id + ".png";
        img.style = "max-width: 450px; max-height: 450px";
        imgContainer.appendChild(img);
        curve.appendChild(imgContainer);
    }
    if (example.name) {
        var p = document.createElement("p");
        p.innerHTML = example.name;
        curve.appendChild(p);
    }
    curves.appendChild(curve);
}

function clearExamples(curves) {
    var canvas = curves.querySelector("canvas");
    if (canvas)
        canvas.singularityExplorer.unregisterEventHandlers();
    while (curves.hasChildNodes())
        curves.removeChild(curves.firstChild);
}

function showExample(example) {
    if (example !== null) {
        var curves = document.getElementById("curves");
        clearExamples(curves);
        appendExample(curves, example, true);
    }
}

function showExamples(examples) {
    if (examples !== null) {
        var curves = document.getElementById("curves");
        clearExamples(curves);
        for (var i = 0; i < examples.length; i++)
            appendExample(curves, examples[i]);
    }
}

document.addEventListener("DOMContentLoaded", function() {
    var req = new XMLHttpRequest();
    req.open("GET", "examples.json");
    req.responseType = "json";
    req.onload = function() {
        examples = req.response;
        showExamples(examples);
    };
    req.send();

    var search = document.querySelector("input[type=search]");
    oldvalue = search.value.toLowerCase();
    search.addEventListener("keydown", function(evt) {
        evt.stopPropagation();
    });
    search.addEventListener("keyup", function(evt) {
        var value = search.value.toLowerCase();
        if (value === oldvalue)
            return;
        oldvalue = value;
        results = examples;
        if (value.length > 0) {
            results = examples.filter(function(example) {
                return example.name.toLowerCase().startsWith(value);
            });
            results = results.concat(examples.filter(function(example) {
                var name = example.name.toLowerCase();
                return !name.startsWith(value) && name.includes(value);
            }));
        }
        showExamples(results);
        evt.stopPropagation();
    });

    var form = document.querySelector("#container form");
    form.addEventListener("submit", function(evt) {
        evt.preventDefault();
        showExample(results[0] || {
            "id": "CustomEquation",
            "equation": search.value
        });
    });
});
</script>
</head>
<body>
<div id="container">
<form>
<input type="search" placeholder="Name or equation of curve" />
</form>
<div id="curves">
</div>
</div>
</body>
</html>
