<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Complex Curves</title>
<link rel="shortcut icon" href="favicon.ico" />
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/semantic-ui/semantic.min.css" />
<script type="text/javascript" src="lib/semantic-ui/semantic.min.js"></script>
<script type="text/javascript" src="build/ComplexCurves.js"></script>
<style type="text/css">
.ui.cards.results {
	border: none;
	border-radius: unset;
	box-shadow: unset;
	display: flex;
}
.ui.cards.results > .card {
	display: flex;
	padding: 0;
}
.ui.cards.results > .card > .content{
	margin: 0 !important;
}
.ui.cards.results > .card > .image{
	width: unset;
	height: unset;
}
.ui.embed[class*="1:1"] {
    position: relative;
    background-color: #002b36 !important;
    margin: 0;
    width: 100%;
    height: 0;
    padding-bottom: 100%;
}
canvas {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
}
</style>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
    var allowHiddenResults = false;
    var canvas = document.querySelector("canvas");
	var examples;
    var req = new XMLHttpRequest();
    req.open("GET", "examples.json");
    req.responseType = "json";
    req.onload = function() {
        examples = req.response;
		$('.ui.search').search({
            duration: 0,
            transition: false,
			maxResults: 50,
			minCharacters: 0,
			searchFields: ['title'],
			searchFullText: true,
			source: examples,
            onResultsOpen: function () {
                $('#ComplexCurves').hide();
                allowHiddenResults = false;
            },
			onResultsClose: function () {
                if(!allowHiddenResults)
                    $('.ui.search').search('show results');
			},
            onSelect: function (example) {
                if(canvas.singularityExplorer)
                    canvas.singularityExplorer.unregisterEventHandlers();
                var piOver180 = Math.PI / 180;
                var lat = 75 * piOver180;
                var lon = 30 * piOver180;
                if(example.cached) {
                    canvas.singularityExplorer =
                        ComplexCurves.fromFile(canvas,
                            'http://complexcurves.org/models/' + example.id +
                            '.bin', lat, lon);
                } else {
                    canvas.singularityExplorer =
                        ComplexCurves.fromEquation(canvas,
                            example.equation ||
                            $('.ui.search').search('get value'),
                            example.depth || 12, lat, lon);
                }
                $('#ComplexCurves').show();
				allowHiddenResults = true;
            },
            templates: {
				message: function(message, type) {
					var
						html = ''
					;
                    var value = $('.ui.search').search('get value');
                    try {
                        PolynomialParser.parse(value);
                        html = $('.ui.search').search('generate results', {
                            "results": [{
                                "id": "Custom",
                                "cached": false,
                                "title": "Custom equation",
                                "equation": value,
                                "description": value
                            }]
                        });
                        $('.ui.search').search('add results', html);
                        return;
                    }
                    catch (Error) {
                    }
					if(message !== undefined && type !== undefined) {
						html +=  ''
						+ '<div class="message ' + type + '">'
						;
						// message type
						if(type == 'empty') {
						html += ''
							+ '<div class="header">No Results</div class="header">'
							+ '<div class="description">' + message + '</div class="description">'
						;
						}
						else {
						html += ' <div class="description">' + message + '</div>';
						}
						html += '</div>';
					}
					return html;
				},
				standard: function(response, fields) {
					var
						html = ''
					;
					if(response[fields.results] !== undefined) {

						// each result
						$.each(response[fields.results], function(index, result) {
						if(result[fields.url]) {
							html  += '<a class="ui card result" href="' + result[fields.url] + '">';
						}
						else {
							html  += '<a class="ui card result">';
						}
						if(result[fields.image] !== undefined) {
							html += ''
							+ '<div class="ui medium image">'
							+ ' <img src="' + result[fields.image] + '">'
							+ '</div>'
							;
						}
						html += '<div class="content">';
						if(result[fields.price] !== undefined) {
							html += '<div class="price">' + result[fields.price] + '</div>';
						}
						if(result[fields.title] !== undefined) {
							html += '<div class="title">' + result[fields.title] + '</div>';
						}
						if(result[fields.description] !== undefined) {
							html += '<div class="description">' + result[fields.description] + '</div>';
						}
						html  += ''
							+ '</div>'
						;
						html += '</a>';
						});

						if(response[fields.action]) {
						html += ''
						+ '<a href="' + response[fields.action][fields.actionURL] + '" class="action">'
						+   response[fields.action][fields.actionText]
						+ '</a>';
						}
						return html;
					}
					return false;
				}
            }
		});
		$('.ui.search').search('search local', '');
		$('.ui.search').search('show results');
    };
    req.send();

});
</script>
</head>
<body class="basic minimal">
<div class="main ui container">
    <div class="ui fluid search" style="margin: 1.75em 0">
        <div class="ui icon input">
            <input class="prompt" placeholder="Name or equation of curve" type="search">
            <i class="search icon"></i>
        </div>
        <div class="ui four cards results"></div>
    </div>
    <div id="ComplexCurves" class="ui grid" style="display: none;">
        <div class="ui twelve wide column">
            <div class="ui 1:1 embed">
                <canvas width="800" height="800"></canvas>
            </div>
        </div>
        <div class="ui four wide column"></div>
    </div>
</div>
</body>
</html>
